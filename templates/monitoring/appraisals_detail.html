{% extends 'monitoring/monitoring_base.html'%}
{% load static %}
{% load crispy_forms_tags %}
{% block title%}| Welcome {% endblock %}


{% block styles %}
<link rel="stylesheet" type="text/css" href="{% static 'css/hospital_dashboard.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'bootstrap/css/bootstrap.min.css' %}">
<!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"> -->

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script> 

{% endblock %}

{% block content %}

<main class="container">

<!-- Banner Section -->
<section class="pt-2 pl-3">
<div class="row">
<div class="col mb-0">
<p class="text-info display-5 paragraph2">Hospital/Centre Internship Accreditation Details</p>
<hr>
</div>
</div>
</section>

<div class="row">
<!-- Left Column: Hospital Details -->
<div class="col-md-7">
<div class="col-md-12">
<!-- Hospital Details -->
<div class="row">
<span class="col-5"><strong>Application No:</strong></span>
<span class="col-6">{{ object.application_no|default:"Not Available" }}</span>
</div>
<div class="row">
<span class="col-5"><strong>Hospital Name:</strong></span>
<span class="col-6">{{ object.hospital_name|default:"Not Available" }}</span>
</div>
<div class="row">
<span class="col-5"><strong>Email:</strong></span>
<span class="col-6">{{ object.hospital_name.hospital_admin|default:"Not Available" }}</span>
</div>
<div class="row">
<span class="col-5"><strong>Application Category:</strong></span>
<span class="col-6">{{ object.hospital.license_type|default:"Not Available" }}</span>
</div>
<div class="row">
<span class="col-5"><strong>Application Type:</strong></span>
<span class="col-6">{{ object.hospital.application_type|default:"Not Available" }}</span>
</div>
<div class="row">
<span class="col-5"><strong>Contact Address:</strong></span>
<span class="col-6">{{ object.hospital.facility_address|default:"Not Available" }}</span>
</div>
<div class="row">
<span class="col-5"><strong>Phone:</strong></span>
<span class="col-6">{{ object.hospital_name.phone_no|default:"Not Available" }}</span>
</div>
<div class="row">
<span class="col-5"><strong>Listed Modalities:</strong></span>
<span class="col-6">{{ object.hospital.equipment|default:"Not Available" }}</span>
</div>

<!-- Radiographer Details -->
<!-- {% for radiographer in object.hospital.radiographers %}
<div class="row">
<span class="col-5"><strong>Radiographer {{ forloop.counter }}:</strong></span>
<span class="col-6">{{ radiographer.name|default:"Not Available" }}</span>
</div>
<div class="row">
<span class="col-5"><strong>License No:</strong></span>
<span class="col-6">{{ radiographer.license_no|default:"Not Available" }}</span>
</div>
{% endfor %} -->

<!-- Staff Details -->
<!-- {% for staff in object.hospital.staff %}
<div class="row">
<span class="col-5"><strong>Staff {{ forloop.counter }} Name:</strong></span>
<span class="col-6">{{ staff.name|default:"Not Available" }}</span>
</div>
<div class="row">
<span class="col-5"><strong>Staff {{ forloop.counter }} Designation:</strong></span>
<span class="col-6">{{ staff.designation|default:"Not Available" }}</span>
</div>
{% endfor %} -->



{% if object.hospital.radiographer_in_charge %}
<div class="row">
<span class="col-5" style="font-size:1.1em;"><strong>Radiographer In Charge:</strong></span>
<span class="col-6" style="font-size:1.1em;">{{object.hospital.radiographer_in_charge}}</span>
</div>
{% endif %}

{% if object.hospital.radiographer_in_charge_license_no %}
<div class="row">
<span class="col-5" style="font-size:1.1em;"><strong>R-I-C License No:</strong></span>
<span class="col-6" style="font-size:1.1em;">{{object.hospital.radiographer_in_charge_license_no}}</span>
</div>
{% endif %}


{% if object.hospital.radiographer1 %}
<div class="row">
<span class="col-5" style="font-size:1.1em;"><strong>Radiographer 1:</strong></span>
<span class="col-6" style="font-size:1.1em;">{{object.hospital.radiographer1}}</span>
</div>
{% endif %}

{% if object.hospital.radiographer1_license_no  %}
<div class="row">
<span class="col-5" style="font-size:1.1em;"><strong>Radiographer 1 License No:</strong></span>
<span class="col-6" style="font-size:1.1em;">{{object.hospital.radiographer1_license_no }}</span>
</div>
{% endif %}

{% if object.hospital.radiographer2 %}
<div class="row">
<span class="col-5" style="font-size:1.1em;"><strong>Radiographer 2:</strong></span>
<span class="col-6" style="font-size:1.1em;">{{object.hospital.radiographer2}}</span>
</div>
{% endif %}

{% if object.hospital.radiographer2_license_no  %}
<div class="row">
<span class="col-5" style="font-size:1.1em;"><strong>Radiographer 2 License No:</strong></span>
<span class="col-6" style="font-size:1.1em;">{{object.hospital.radiographer2_license_no }}</span>
</div>
{% endif %}
                
{% if object.hospital.radiographer3 %}
<div class="row">
<span class="col-5" style="font-size:1.1em;"><strong>Radiographer 3:</strong></span>
<span class="col-6" style="font-size:1.1em;">{{object.hospital.radiographer3}}</span>
</div>
{% endif %}

{% if object.hospital.radiographer3_license_no  %}
<div class="row">
<span class="col-5" style="font-size:1.1em;"><strong>Radiographer 3 License No:</strong></span>
<span class="col-6" style="font-size:1.1em;">{{object.hospital.radiographer3_license_no }}</span>
</div>
{% endif %}

{% if object.hospital.staffname1 %}
<div class="row">
<span class="col-5" style="font-size:1.1em;"><strong>Staff 1 Name:</strong></span>
<span class="col-6" style="font-size:1.1em;">{{object.hospital.staffname1}}</span>
</div>
{% endif %}

{% if object.hospital.staffdesignation1 %}
<div class="row">
<span class="col-5" style="font-size:1.1em;"><strong>Staff 1 Designation:</strong></span>
<span class="col-6" style="font-size:1.1em;">{{object.hospital.staffdesignation1}}</span>
</div>
{% endif %}

{% if object.hospital.staffname2 %}
<div class="row">
<span class="col-5" style="font-size:1.1em;"><strong>Staff 2 Name:</strong></span>
<span class="col-6" style="font-size:1.1em;">{{object.hospital.staffname2}}</span>
</div>
{% endif %}

{% if object.hospital.staffdesignation2 %}
<div class="row">
<span class="col-5" style="font-size:1.1em;"><strong>Staff 2 Designation:</strong></span>
<span class="col-6" style="font-size:1.1em;">{{object.hospital.staffdesignation2}}</span>
</div>
{% endif %}

{% if object.hospital.staffname3 %}
<div class="row">
<span class="col-5" style="font-size:1.1em;"><strong>Staff 3 Name:</strong></span>
<span class="col-6" style="font-size:1.1em;">{{object.hospital.staffname3}}</span>
</div>
{% endif %}

{% if object.hospital.staffdesignation3 %}
<div class="row">
<span class="col-5" style="font-size:1.1em;"><strong>Staff 3 Designation:</strong></span>
<span class="col-6" style="font-size:1.1em;">{{object.hospital.staffdesignation3}}</span>
</div>
{% endif %}

{% if object.hospital.staffname4 %}
<div class="row">
<span class="col-5" style="font-size:1.1em;"><strong>Staff 4 Name:</strong></span>
<span class="col-6" style="font-size:1.1em;">{{object.hospital.staffname4}}</span>
</div>
{% endif %}

{% if object.hospital.staffdesignation4 %}
<div class="row">
<span class="col-5" style="font-size:1.1em;"><strong>Staff 4 Designation:</strong></span>
<span class="col-6" style="font-size:1.1em;">{{object.hospital.staffdesignation4}}</span>
</div>
{% endif %}

{% if object.hospital.staffname5 %}
<div class="row">
<span class="col-5" style="font-size:1.1em;"><strong>Staff 5 Name:</strong></span>
<span class="col-6" style="font-size:1.1em;">{{object.hospital.staffname5}}</span>
</div>
{% endif %}

{% if object.hospital.staffdesignation5 %}
<div class="row">
<span class="col-5" style="font-size:1.1em;"><strong>Staff 5 Designation:</strong></span>
<span class="col-6" style="font-size:1.1em;">{{object.hospital.staffdesignation5}}</span>
</div>
{% endif %}


</div>

<div class="col-md-12 mt-4">
<div class="row">
<p class="col-12 text-success lead">Control Details</p>
</div>
<div class="row">
<span class="col-5"><strong>Inspection Date:</strong></span>
<span class="col-6">{{ object.schedule.inspection_date|default:"Not Scheduled" }}</span>
</div>
<div class="row">
<span class="col-5"><strong>Inspection Zone:</strong></span>
<span class="col-6">{{ object.schedule.inspection_zone|default:"Not Available" }}</span>
</div>
</div>
</div>

<!-- Right Column: Appraisal Details -->
<div class="col-md-5">
<p class="text-success lead">Appraisal Score</p>
<span><strong><mark>{{ object.appraisal_total|default:"-" }}</mark></strong></span>
<br><br>
<p class="text-success lead">Accreditation Comments/Observations</p>
<span><mark>{{ object.appraisal_comments|default:"No Comments Provided" }}</mark></span>
<br><br>

<!-- Photo Uploads -->
<p class="text-success lead">Accreditation Uploads</p>
<div class="row py-0">
<table class="table table-hover">
<thead style="background-color: #bfe3f8;">
<tr>
<th scope="col" style="color: #05567b;">Parameter</th>
<th scope="col" style="color: #05567b;">Value</th>
</tr>
</thead>
<tbody>

{% for photo in photos %}
{% if photo %}
<tr>
<td>{{ photo.label }}</td>
<td>
<a class="text-danger" href="{{ photo.image.url }}" target="_blank">
<i class="fa fa-eye text-dark"></i> View
</a>
</td>
</tr>
{% endif %}
{% endfor %}
</tbody>
</table>
</div>
</div>
</div>

<hr>

<!-- Action Buttons -->
{% if object.appraisal_status == 1 %}
<div class="d-flex justify-content-end">
<a href="{% url 'monitoring:monitoring_dashboard' %}" class="btn btn-outline-dark px-3">
<i class="fa fa-window-close text-danger"></i> Return to Dashboard
</a>
<a href="{% url 'monitoring:inspections_list' %}" class="btn btn-info ml-4 px-3">
<i class="fa fa-window-close text-danger"></i> Return to Inspection Reports
</a>



<button class="btn btn-success ml-4 px-3" onclick="confirmAction('approve_appraisal_report{{ object.id }}')">
Approve Accreditation Report
<i class="fa fa-podcast text-white"></i>
</button>
<button class="btn btn-danger ml-4 px-3" data-bs-toggle="modal" data-bs-target="#rejectModal">
Reject Accreditation Report
<i class="fa fa-podcast text-white"></i>
</button>
</div>
{% else %}
<div class="d-flex justify-content-end">
<a href="{% url 'monitoring:inspections_list' %}" class="btn btn-info px-3">
<i class="fa fa-window-close text-danger"></i> Return to Inspection Reports
</a>
<a href="{% url 'monitoring:monitoring_dashboard' %}" class="btn btn-outline-dark px-3 ml-4">
<i class="fa fa-window-close text-danger"></i> Return to Dashboard
</a>
</div>
{% endif %}

</main>

<!-- Reject Modal -->
<div class="modal fade" id="rejectModal" tabindex="-1" aria-labelledby="rejectModalLabel" aria-hidden="true">
<div class="modal-dialog">
<div class="modal-content">
<form id="rejectForm{{ object.id }}" method="POST" action="{% url 'monitoring:reject_appraisal_report' object.id %}">
{% csrf_token %}
<div class="modal-header">
<h5 class="modal-title text-danger" id="rejectModalLabel">Reject Accreditation Report</h5>
<button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
</div>
<div class="modal-body">
<p>Please provide a reason for rejecting this report:</p>
<div class="form-group">
<textarea 
name="rejection_reason" 
class="form-control" 
rows="3" 
placeholder="Enter reason for rejection" 
required>
</textarea>
</div>
</div>
<div class="modal-footer">
<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
<button type="submit" class="btn btn-danger">Reject Application</button>
</div>
</form>
</div>
</div>
</div>

<!-- Approve Form -->
<form id="approve_appraisal_report{{ object.id }}" method="POST" action="{% url 'monitoring:approve_appraisal_report' object.id %}">
{% csrf_token %}
</form>

<script>
function confirmAction(formId) {
if (confirm("Are you sure you want to proceed?")) {
document.getElementById(formId).submit();
}
}
</script>




<!--Jquery plugin-->
  <script src="{% static 'js/jquery.js' %}"></script>

<!--other javascript plugins-->
  <script src="{% static 'js/bootstrap.min.js' %}"></script>
  <script src="{% static 'js/jquery.dataTables.min.js' %}"></script>
  <script src="{% static 'js/dataTables.bootstrap.min.js' %}"></script>
  <script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
  <script>
  $('#mydata').dataTable();

  let urlMenu = document.getElementById('dropdown');
  urlMenu.onchange = function(){
    let userOption = this.options[this.selectedIndex];
    if(userOption.value != "nothing"){
      window.open(userOption.value, "_self", "");
    }
  }
  </script>


{% endblock %}
